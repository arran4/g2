# Bug Report: Migration to `go-subcommand` breaks CLI interface

## Summary
Migrating `g2` to `github.com/arran4/go-subcommand` (v0.0.11) is currently not possible without breaking the existing CLI interface. Specifically, the library does not support passing flags to a parent command before specifying a subcommand (e.g., `parent -flag child`).

## Detailed Description
The current `g2` CLI supports invoking subcommands with flags belonging to the parent command specified before the subcommand.

**Example (Current working behavior):**
```bash
g2 manifest -blake2b=true upsert-from-url <url> <filename> <target>
```

In this command:
1. `manifest` is the command.
2. `-blake2b=true` is a flag for the `manifest` command.
3. `upsert-from-url` is the subcommand.

The current implementation in `main.go` parses flags for `manifest`, consumes them, and then looks at the next argument (`fs.Arg(0)`) to determine the subcommand.

## The Issue with `go-subcommand`
The code generated by `gosubc` attempts to dispatch to a subcommand **immediately** by checking if the first argument (`args[0]`) matches a known subcommand name.

If flags are provided first, `args[0]` is the flag (e.g., `-blake2b=true`), which does not match any subcommand. The generated code then falls back to parsing flags for the parent command (`Manifest`). However, after parsing flags, it **does not** check if the remaining arguments constitute a subcommand. It simply executes the parent command's handler.

**Result with `go-subcommand`:**
Running:
```bash
g2 manifest -blake2b=true upsert-from-url ...
```
1. `args[0]` is `-blake2b=true`. No subcommand match.
2. Flags are parsed. `blake2b` is set.
3. `Manifest` handler is executed.
4. `upsert-from-url` is treated as a positional argument to `Manifest`, or ignored if `Manifest` takes no arguments.
5. The `UpsertFromUrl` subcommand is **never executed**.

To make this work with `go-subcommand`, the user would be forced to move flags to the leaf command or put them after the subcommand (if supported), or the library needs to support parsing flags before dispatching.

## Conclusion
Since the requirement is "maintain the cli without any functional loss or cli interface changes", the migration cannot be completed with the current version of `go-subcommand` (v0.0.11).

## Fix Required in `go-subcommand`
To support this, `gosubc` needs to generate code that:
1. Attempts to parse flags for the current command if `args[0]` is not a subcommand.
2. After parsing flags, checks the first remaining argument to see if it is a subcommand.
3. If it is a subcommand, dispatches to it with the remaining arguments.
